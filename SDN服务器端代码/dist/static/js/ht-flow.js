!function(Z){"use strict";var c=Z.ht,I=c.Default,A=I.getInternal(),B=A.ui(),s=null,p="__segmentLengths",l="__lineTotalLength",r="__linePoints",T="__distance0",E="flow.count",S="flow.step",J="flow.element.max",N="flow.element.count",n="flow.element.min",w="flow.element.space",L="flow.element.autorotate",U="flow.element.background",H="flow.element.shadow.max",d="flow.element.shadow.min",F="flow.element.shadow.begincolor",$="flow.element.shadow.endcolor",V="flow.element.shadow.visible",D="flow.element.image",j="flow",e=c.Math.Vector2,b=new e;new e,new e,c.List;var K=c.Default._edgeProtectMethod,R=K.getStraightLinePoints,o=function(v,u){for(var Q=[],r=v.length,O=0;r>O;O++){var A=v[O];A._as&&(A=A._as);for(var x=A[0],T=1;T<A.length;T++)Q.push([x,A[T]]),x=A[T]}for(var W=[],O=0;O<Q.length;O++){var U=z(Q[O][0],Q[O][1],u);W.push(U)}return{distance:W,segments:Q}},u=function($,k,y){if($){for(var M,h=o($,k),n=h.distance,v=h.segments,X=1/0,m=null,W=0,Y=n.length;Y>W;W++){var B=n[W];B.z<X&&(M=W,X=B.z,m=B)}if(null==y&&(y=.1),m.z<y){for(var F=0,s=0;M>=s;s++)F+=I.getDistance(v[s][0],M>s?v[s][1]:m);return F}}},z=function(K,b,y){var h=K.x,$=K.y,s=b.x,Z=b.y,E=y.x,Y=y.y,l=s-h,U=Z-$,d=Math.sqrt(l*l+U*U),D=l/d,Q=U/d,A=(-h+E)*D+(-$+Y)*Q,M={x:h+A*D,y:$+A*Q};return M.x>=Math.min(K.x,b.x)&&M.x<=Math.max(K.x,b.x)&&M.y>=Math.min(K.y,b.y)&&M.y<=Math.max(K.y,b.y)||(M.x=Math.abs(M.x-K.x)<Math.abs(M.x-b.x)?K.x:b.x,M.y=Math.abs(M.y-K.y)<Math.abs(M.y-b.y)?K.y:b.y),l=E-M.x,U=Y-M.y,M.z=Math.sqrt(l*l+U*U),M},q=function(v,P){if(v){var M=o(v,P).distance,W=1/0,g=null;return M.forEach(function(u){u.z<W&&(W=u.z,g=u)}),g}},i=K.calculateLineLength,m=K.calcSegmentIndexByDistance,k=K.calculatePointAlongLine,_=function(D,N,Q){if(!D)return Q;if(0===N){var g=D[0][0],y=D[0][1];return Q+Math.atan2(y.y-g.y,y.x-g.x)}if(100===N){D=D[D.length-1];var g=D[D.length-2],y=D[D.length-1];return Q+Math.atan2(y.y-g.y,y.x-g.x)}for(var $=0,c=[],W=D.length,Z=0;W>Z;Z++){var s=D[Z],S=i(s);$+=S,c.push(S)}for(var H=$*N/100,I=m(H,c),h=0,J=0;I>J;J++)h+=c[J];H-=h;for(var w=k(D[I],H),r=D[I],e=0,M=0,n=0;n<r.length-1;n++){var B=r[n],T=r[n+1],K=T.x-B.x,b=T.y-B.y,C=Math.sqrt(K*K+b*b);if(e+=C,e>H){M=n;break}}var L=r[M];return Q+Math.atan2(w.y-L.y,w.x-L.x)},Q=function(I){var A=0;if(I)if(Array.isArray(I[0]))for(var c=I.length,J=0;c>J;J++){var O=I[J],Y=i(O);A+=Y}else A=i(I);return A},G=function(U,d,i,l){return b.set(d,i).rotateAround(null,l),U?{x:U.x+b.x,y:U.y+b.y}:{x:b.x,y:b.y}},P=function(M){var H=M._data,v=R(M);if(v){H.s("flow.reverse")&&(v.reverse(),v.forEach(function(f){f.reverse()}));for(var u=0,s=[],V=v.length,D=0;V>D;D++){var t=v[D],U=i(t);u+=U,s.push(U)}if(H[p]=s,H[l]=u,H[r]=v,H instanceof c.Edge){var L=I.unionPoint(v),$=L.x+L.width/2,Y=L.y+L.height/2;H.$10e={x:$,y:Y}}W(M,!0)}},y=K.getPercentPosition,W=function(_,w){var O=_._data,j=O[l],H=O.s(E),x=O.s(S),B=0,V=O[p],R=O.s(J),W=O.s(n),P=O.s(N),q=(R-W)/(P-1),c=[];if(V){if(1===P)c.push(R);else if(2===P)c.push(R),c.push(W);else{if(!(P>2))return;c.push(R);for(var Z=P-2;Z>0;Z--)c.push(W+q*Z);c.push(W)}var e=0,U=0;c.forEach(function(q){P-1>e&&(U+=O.getFlowElementSpace(q)),e++}),U+=(R+W)/2,B=(j-H*U+U)/H;var t=_[T];for(null==t&&(t=0),w||(t+=x);t>j+U;){var y=_._overCount;y?y++:y=1,y>=H&&(y=null),_._overCount=y,O.s("flow.autoreverse")?y?t-=B+U:(t=0,O.s("flow.reverse",!O.s("flow.reverse"))):t-=B+U}_[T]=t}},h="prototype",Y=c.graph.GraphView[h],v=c.Data[h],M=B.DataUI[h],f=B.ShapeUI[h],x=B.EdgeUI[h],t=c.DataModel[h],a=c.Style;a[J]==s&&(a[J]=7),a[n]==s&&(a[n]=0),a[E]==s&&(a[E]=1),a[S]==s&&(a[S]=3),a[N]==s&&(a[N]=10),a[w]==s&&(a[w]=3.5),a[L]==s&&(a[L]=!1),a[U]==s&&(a[U]="rgba(255, 255, 114, 0.4)"),a[F]==s&&(a[F]="rgba(255, 255, 0, 0.3)"),a[$]==s&&(a[$]="rgba(255, 255, 0, 0)"),a[V]==s&&(a[V]=1),a[H]==s&&(a[H]=22),a[d]==s&&(a[d]=4),Y.calculatePointLength=function(y,L,p){var v=this.getDataUI(y),d=R(v);return u(d,L,p)},I.calculatePointLength=function(q,E,y,l){var X=R(s,q,E);return u(X,y,l)},I.calculateClosestPointOnLine=z,Y.calculateClosestPoint=function(k,Q){var U=this.getDataUI(k),z=R(U);return q(z,Q)},I.calculateClosestPoint=function(I,N,b){var t=R(s,I,N);return q(t,b)},Y.getPercentAngle=function(l,X){var p=this.getDataUI(l),x=R(p);return l.getRotation?l.getRotation():0,_(x,X,l.getRotation?l.getRotation():0)},I.getPercentAngle=function(t,p,d){var V=R(s,t,p);return _(V,d,0)},Y.calculateLength=function(H){var q=this.getDataUI(H),c=R(q);return Q(c)},I.calculateLength=function(p,q){var v=R(s,p,q);return Q(v)},Y.getPercentPosition=function(U,t){var b=this.getDataUI(U),g=R(b);return y(g,t)},I.getPercentPositionOnPoints=function(O,u,f){var q=R(s,O,u);return y(q,f)};var C=function(O){var P=O.data,F=this.dm();if(P&&"add"===O.kind){var R=F.$3e;R&&P.s(j)&&R.indexOf(P)<0&&R.push(P)}"clear"===O.kind&&(F.$3e=[])},g=function(p){var j=p.property,Z=p.data,A=p.newValue,g=this.dm().$3e;if(g&&"s:flow"===j)if(A)g.indexOf(Z)<0&&g.push(Z);else for(var n=g.length,T=0;n>T;T++)if(g[T]===Z){g.splice(T,1);break}},X=Y.setDataModel;Y.setDataModel=function(B){var Z=this,J=Z._dataModel;if(J!==B){J&&(J.umm(C,Z),J.umd(g,Z),J.$3e=[]),B.mm(C,Z),B.md(g,Z);var K=B.$3e=[];B.each(function(T){T.s(j)&&K.indexOf(T)<0&&K.push(T)}),X.call(Z,B)}},v.getFlowElementSpace=function(){return this.s(w)};var O=function(I){var P=this,W=P._data,_=W[l],A=W[p],t=W[r],o=W.s(E),g=0,C=P[T],Y=W.s(J),Q=W.s(n),j=W.s(N),h=W.s(d),Z=W.s(H),v=W.s(L),w=(Z-h)/(j-1),U=(Y-Q)/(j-1),F=W.getRotation?W.getRotation():0,b=W.getPosition?W.p():W.$10e,O=[],B=[];if(C!=s){if(1===j)O.push(Y);else if(2===j)O.push(Y),O.push(Q);else{if(!(j>2))return;O.push(Y);for(var c=j-2;c>0;c--)O.push(Q+U*c);O.push(Q)}if(1===j)B.push(Z);else if(2===j)B.push(Z),B.push(h);else{if(!(j>2))return;B.push(Z);for(var c=j-2;c>0;c--)B.push(h+w*c);B.push(h)}var S=0,V=0;O.forEach(function(Y){j-1>S&&(V+=W.getFlowElementSpace(Y)),S++}),V+=(Y+Q)/2,g=(_-o*V+V)/o,I.save();for(var c=0;o>c;c++){var z=C,M=0,i=P._overCount,u=0;W.s("flow.autoreverse")&&i&&i>o-(c+1)||(z-=c*(g+V),S=0,O.forEach(function(K){var V=z-M;if(V>=0&&_>V){var q=!0,L=m(V,A);u=0;for(var p=0;L>p;p++)u+=A[p];if(V-=u,q){var f=k(t[L],V),D=F;if(v){for(var s=t[L],y=0,N=0,R=0;R<s.length-1;R++){var l=s[R],w=s[R+1],g=w.x-l.x,h=w.y-l.y,E=Math.sqrt(g*g+h*h);if(y+=E,y>V){N=R;break}}var X=s[N];D+=Math.atan2(f.y-X.y,f.x-X.x)}F&&(f=G(b,f.x-b.x,f.y-b.y,F)),P.$5e(I,f,K,B[S],D)}}M+=W.getFlowElementSpace(O[S]),S++}))}I.restore()}},ks=x._80o;x._80o=function(A){ks.call(this,A);var t=this,i=t._data,z=t.gv;i.s(j)&&z.$7e!=s&&O.call(t,A)};var Kb=f._80o;f._80o=function(z){Kb.call(this,z);var J=this,a=J._data,E=J.gv;a.s(j)&&E.$7e!=s&&O.call(J,z)};var Qr=x._79o,ck=f._79o,_d=function(){var C=this,D=C._data,Q=D.s(J),z=!1,A=s;if(C._6I||(z=!0),A=D instanceof c.Edge?Qr.call(C):ck.call(C),D.s(j)&&z){var S=D.s(H),h=D.s(V);h&&S>Q&&(Q=S),Q>0&&I.grow(A,Math.ceil(Q/2)),P(C)}return!D.s(j)&&z&&(D[p]=D[l]=D[r]=C[T]=s),A};f._79o=_d,x._79o=_d,M.$5e=function(n,B,P,y,X){var l=this,W=l._data,Q=l.gv,x=W.s(U),z=W.s(F),r=W.s($),j=W.s(V),i=Q.$8e,R=W.s(D);if(i==s&&(i=Q.$8e={}),n.beginPath(),R!=s){var J=I.getImage(R),Z=P/2;n.translate(B.x,B.y),n.rotate(X),n.translate(-B.x,-B.y),I.drawImage(n,J,B.x-Z,B.y-Z,P,P,W),n.translate(B.x,B.y),n.rotate(-X),n.translate(-B.x,-B.y)}else if(Q.__flowBatch){var c=Q.__flowBatchGroup;c||(c=Q.__flowBatchGroup={});var S=[B.x,B.y,P/2];c[x]?c[x].push(S):c[x]=[S]}else n.fillStyle=x,n.arc(B.x,B.y,P/2,0,2*Math.PI,!0),n.fill();if(j){var E=22,e=E+"_"+z+"_"+r,k=i[e];if(k==s){var _=document.createElement("canvas");A.setCanvas(_,E,E);var o=_.getContext("2d"),C=E/2,N=C,p=C;A.translateAndScale(o,0,0,1),o.beginPath();var d=o.createRadialGradient(N,p,0,N,N,C);d.addColorStop(0,z),d.addColorStop(1,r),o.fillStyle=d,o.arc(N,p,C,0,2*Math.PI,!0),o.fill(),k=i[e]=_}var Z=y/2;I.drawImage(n,k,B.x-Z,B.y-Z,y,y,W)}},Y.$9e=function(){var b=this,v=b.dm().$3e;b._24I,v.forEach(function(W){b._24I[W._id]=W}),b.iv()};var fk=t.prepareRemove;t.prepareRemove=function(V){fk.call(this,V);var w=V._dataModel,R=w.$3e;if(R)for(var j=R.length,X=0;j>X;X++)if(R[X]===V){R.splice(X,1);break}},Y.setFlowInterval=function(I){var g=this,c=g.$11e;g.$11e=I,g.fp("flowInterval",c,I),g.$7e!=s&&(clearInterval(g.$7e),delete g.$7e,g.enableFlow(I))},Y.getFlowInterval=function(){return this.$11e},Y.enableFlow=function(c){var k=this,g=k.dm(),f=g.$3e;k.$7e==s&&(f.forEach(function(W){var O=k.getDataUI(W);P(O)}),k.$7e=setInterval(function(){g.$3e.forEach(function(f){W(k.getDataUI(f))}),k.$9e()},c||k.$11e||50))},Y.disableFlow=function(){var b=this;clearInterval(b.$7e),delete b.$7e;var r=b.dm().$3e;r&&b.$9e()};var fo=function(){this.__flowBatchGroup={}},vq=function(i){var R=this.__flowBatchGroup;if(R){i.save();for(var U in R){i.fillStyle=U,i.beginPath();var l=R[U];l.forEach(function(V){i.moveTo(V[0],V[1]),i.arc(V[0],V[1],V[2],0,2*Math.PI,!0)}),i.fill()}i.restore()}};Y.setFlowBatch=function(x){var Q=this;!!Q.__flowBatch!=!!x&&(Q.__flowBatch=x,x?(Q.addBottomPainter(fo),Q.addTopPainter(vq)):(Q.removeBottomPainter(fo),Q.removeTopPainter(vq)))}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);